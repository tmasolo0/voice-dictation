# Voice Dictation

Голосовой ввод текста для Windows. Нажми клавишу — говори — текст вставляется в любое приложение.

Распознавание работает локально через [faster-whisper](https://github.com/SYSTRAN/faster-whisper), интернет не нужен.

## Что умеет

- **Push-to-talk диктовка** — удерживай F9, говори, отпусти — текст вставится в активное поле
- **Локальное распознавание** — всё работает офлайн, данные не уходят в сеть
- **Русский + английский** — автоопределение языка, можно говорить вперемешку
- **Режим перевода** — переводит речь на английский (ПКМ на виджете или через трей)
- **Минималистичный виджет** — круглый индикатор на экране: зелёный = готов, красный = запись, жёлтый = обработка, синий = перевод
- **Системный трей** — сворачивается, не мешает работе, прячется в fullscreen-приложениях
- **Настройки** — горячая клавиша, модель, язык, размер виджета — всё через GUI

## Требования

- Windows 10/11
- NVIDIA GPU с CUDA (рекомендуется, без GPU работает на CPU — медленнее)
- ~1.5 GB для модели Whisper large-v3-turbo

## Установка

### Вариант 1: С встроенным Python (рекомендуется)

Используется портативный Python 3.11 — не конфликтует с системным.

1. Скачай и распакуй проект
2. Скачай [Python 3.11 Windows embeddable (64-bit)](https://www.python.org/ftp/python/3.11.9/python-3.11.9-embed-amd64.zip)
3. Распакуй в папку `python311/` внутри проекта
4. Включи pip:
   - Открой `python311/python311._pth` в блокноте
   - Раскомментируй строку `#import site` (убери `#`)
   - Сохрани
5. Установи pip:
   ```
   cd python311
   curl -O https://bootstrap.pypa.io/get-pip.py
   python.exe get-pip.py
   cd ..
   ```
6. Запусти `install_local.bat` — установит все зависимости
7. Готово

### Вариант 2: С системным Python

Если у тебя уже установлен Python 3.10+:

1. Скачай и распакуй проект
2. Установи зависимости:
   ```
   pip install PyQt6 pywin32 faster-whisper sounddevice numpy keyboard pyperclip pyautogui
   ```
3. Запускай напрямую:
   ```
   python dictation.pyw
   ```

### Ручная установка зависимостей (с встроенным Python)

```
.\python311\python.exe -m pip install PyQt6 pywin32 faster-whisper sounddevice numpy keyboard pyperclip pyautogui
```

## Запуск

| Файл | Описание |
|------|----------|
| `Dictation.vbs` | Запуск без консоли (основной способ) |
| `Dictation.bat` | Запуск с консолью (для отладки) |

При первом запуске модель `large-v3-turbo` (~1.5 GB) скачается автоматически в папку `models/`.

### Ручное скачивание модели

Если автоматическое скачивание не работает (нет интернета, проблемы с HuggingFace), модель можно скачать вручную:

1. Скачай модель с HuggingFace: https://huggingface.co/Systran/faster-whisper-large-v3-turbo
   - Нажми "Files and versions" → скачай все файлы
   - Или используй `git clone https://huggingface.co/Systran/faster-whisper-large-v3-turbo`
2. Положи файлы в папку `models/large-v3-turbo/`

Итоговая структура должна выглядеть так:
```
models/
└── large-v3-turbo/
    ├── config.json
    ├── model.bin
    ├── tokenizer.json
    └── vocabulary.txt
```

Другие модели скачиваются аналогично — меняется только название в URL и папке:

| Модель | Репозиторий | Папка |
|--------|------------|-------|
| large-v3-turbo | `Systran/faster-whisper-large-v3-turbo` | `models/large-v3-turbo/` |
| large-v3 | `Systran/faster-whisper-large-v3` | `models/large-v3/` |
| medium | `Systran/faster-whisper-medium` | `models/medium/` |
| small | `Systran/faster-whisper-small` | `models/small/` |

Для модели `medium` (режим перевода) есть готовый скрипт:
```
.\python311\python.exe download_medium.py
```

## Как пользоваться

1. Запусти `Dictation.vbs`
2. На экране появится зелёный круглый виджет
3. Нажми и удерживай **F9** (виджет станет красным)
4. Говори
5. Отпусти **F9** (виджет станет жёлтым — обработка)
6. Текст автоматически вставится в активное поле

### Управление

| Действие | Как |
|----------|-----|
| Перетащить виджет | Левая кнопка мыши |
| Контекстное меню | Правая кнопка мыши |
| Переключить режим перевода | ПКМ → "Перевод → EN" |
| Свернуть в трей | ПКМ → "Свернуть в трей" |
| Развернуть из трея | Двойной клик на иконке в трее |

### Режим перевода

Переключается через контекстное меню (ПКМ на виджете) или через трей. В этом режиме речь на любом языке переводится на английский. Виджет становится синим с надписью "EN". Используется модель `medium` (нужно скачать отдельно: `.\python311\python.exe download_medium.py`).

## Настройки

Хранятся в `config.json` (создаётся автоматически при первом запуске):

```json
{
  "widget": {
    "size": 150,
    "hide_in_fullscreen": true
  },
  "recognition": {
    "hotkey": "f9",
    "model": "large-v3-turbo",
    "device": "cuda",
    "language": "auto",
    "beam_size": 5
  }
}
```

### dictionary.txt

Отраслевой словарь терминов — один термин на строку. Модель учитывает эти термины при распознавании. Добавь сюда специфичные слова из твоей работы — имена продуктов, технические термины, аббревиатуры. Это улучшает точность.

### Модели Whisper

| Модель | Размер | Качество | Скорость | VRAM |
|--------|--------|----------|----------|------|
| small | ~500 MB | Хорошее | Быстро | ~2 GB |
| medium | ~1.5 GB | Высокое | Средне | ~5 GB |
| **large-v3-turbo** | ~1.5 GB | Отличное | Быстро | ~6 GB |
| large-v3 | ~3 GB | Лучшее | Медленно | ~10 GB |

По умолчанию используется `large-v3-turbo` — лучший баланс качества и скорости.

## Структура проекта

```
voice-dictation/
├── dictation.pyw          # Главный файл приложения
├── Dictation.vbs          # Запуск без консоли
├── Dictation.bat          # Запуск с консолью
├── install_local.bat      # Установка зависимостей
├── settings_dialog.py     # GUI настроек
├── download_medium.py     # Скачивание модели medium (для перевода)
├── core/                  # Модули ядра
│   ├── config_manager.py  # Управление config.json
│   ├── recognizer.py      # Whisper STT
│   ├── hotkeys.py         # Глобальные горячие клавиши
│   └── tray.py            # Системный трей
├── config.json            # Настройки приложения
├── dictionary.txt         # Отраслевой словарь терминов
├── models/                # Модели Whisper (не в git)
├── logs/                  # Логи ошибок (не в git)
└── python311/             # Встроенный Python (не в git)
```

## Решение проблем

**Виджет не появляется** — проверь `logs/dictation.log`

**GPU не используется** — убедись что установлен CUDA-совместимый PyTorch. Или смени `device` на `cpu` в `config.json`

**Плохое распознавание** — добавь специфичные термины в `dictionary.txt` (один термин на строку)

**Нет звука с микрофона** — проверь что микрофон выбран по умолчанию в настройках Windows
